# LLM-D Monitoring Stack

This directory contains the Kustomize configuration for deploying Prometheus and Grafana monitoring for the LLM-D environment.

This deploys:

- Prometheus for metrics collection and alerting
- Grafana for visualization with pre-configured LLM performance dashboard
- Auto-discovery of vLLM pods (no manual annotation required)

## Components

- **Prometheus**: Metrics collection and storage
- **Grafana**: Visualization and dashboards
- **ConfigMaps**: Configuration for both services including datasources and dashboards

## Installation

### Using Kustomize

To deploy the monitoring stack:

```sh
oc apply -k gitops/instance/llm-d-monitoring
```

### Using oc (kubectl) directly (legacy)

Alternatively, you can use the individual commands:

```sh
oc create namespace llm-d-monitoring || true
oc apply -f gitops/instance/llm-d-monitoring/grafana.yaml
oc apply -f gitops/instance/llm-d-monitoring/grafana-service.yaml
oc apply -f gitops/instance/llm-d-monitoring/prometheus.yaml
oc apply -f gitops/instance/llm-d-monitoring/grafana-datasources.yaml
oc apply -f gitops/instance/llm-d-monitoring/grafana-dashboards-config.yaml
oc apply -f gitops/instance/llm-d-monitoring/grafana-config.yaml
oc apply -f gitops/instance/llm-d-monitoring/prometheus-config.yaml
oc apply -f gitops/instance/llm-d-monitoring/grafana-dashboard-llm-performance.json
```

## Files

- `namespace.yaml` - Creates the llm-d-monitoring namespace
- `prometheus.yaml` - Prometheus deployment and RBAC
- `prometheus-config.yaml` - Prometheus configuration ConfigMap
- `grafana.yaml` - Grafana deployment and ServiceAccount
- `grafana-service.yaml` - Grafana Service
- `grafana-config.yaml` - Grafana main configuration
- `grafana-datasources.yaml` - Grafana datasources configuration
- `grafana-dashboards-config.yaml` - Grafana dashboard provisioning configuration
- `grafana-dashboard-llm-performance.json` - LLM Performance dashboard
- `kustomization.yaml` - Kustomize configuration file

## Notes

The ConfigMap for the Grafana dashboard (`grafana-dashboard-llm-performance`) is automatically generated by Kustomize from the JSON file.

### Access Grafana

```sh
# Get the Grafana route URL
oc get route grafana -n llm-d-monitoring -o jsonpath='{.spec.host}'
```

Default credentials (edit):

- Username: `admin`
- Password: `admin`

The LLM Performance dashboard will automatically display metrics from all vLLM pods.

#### Uninstall Monitoring

```sh
oc delete -k gitops/instance/llm-d-monitoring
```
